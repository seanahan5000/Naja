ORBLINE			EQU	$01
CATION			EQU	$02

				LDX	#<OG_DATA
				LDY	#>OG_DATA
				JSR	SET_TLP_DATA

				LDA	#$40
				STA	PAGE
				JSR	CLEAR2
				JSR	GETNSEW
				JSR	NOSCAN
				LDY	#0
				JSR	PICKER
				LDA	#$76
				STA	ORBLINE
			;	LDA	TRACER+2
			;	AND	#$80
	LDA	GOT_ORB					;***
				BEQ	:ORBHERE
				LDA	#$20
				STA	PAGE
				STA	SCNDARY
				JSR	MOVETO1
				STA	PRIMARY
				JMP	KEYWAIT
:ORBHERE		JSR	DRAW
				STA	SCNDARY
				JSR	MOVETO1
				STA	PRIMARY
				JSR	CLEAR2
				LDA	#GREEN
				STA	COLOR
				LDY	#0
				JSR	LINER
				LDY	#0
				JSR	TEXTER
				JSR	FLIP_BOX
				LDA	#$20
				STA	PAGE
;				JSR	LOCATE
	LDA	#$00					;***
				STA	CATION
				LDA	#$A0
				STA	SPASPOT+1
				JSR	ANIMATE_ORB
				LDA	CATION
				BMI	NOROOM
				LSR	A
				LSR	A
				LSR	A
				LSR	A
				JSR	POINTIT
;				LDA	CATION
;				AND	#$0F
;				TAY
;				LDA	CORESPS,Y
;				TAY
;				LDX	#$00
;GIVORB			LDA	DATAORB,X
;				STA	(CHARDL),Y
;				INY
;				INX
;				CPX	#$04
;				BNE	GIVORB

;				LDA	TRACER+2
;				ORA	#$C0
;				STA	TRACER+2

			LDA	#$FF				;***
			STA GOT_ORB				;***

				JSR	ERASE
				JSR	BLACK_BOX
				LDX	#$00
				LDY	#$00
				JSR	NAMEIT
DESPAC			DEX
				LDA	TEXTBUF,X
				CMP	#$0A
				BEQ	DESPAC
				LDA	#$8D
				STA	TEXTBUF+1,X
				LDA	#$0A
				LDY	#$27
				JSR	LINE
				LDA	XCOORD
				STA	OG_TEXT2
				LDA	SHIFT
				STA	OG_TEXT2+1
				LDY	#$02
				JSR	TEXTER
				LDX	#$05
WAITER			LDA	#$00
				JSR	WAIT2
				DEX
				BPL	WAITER
				JSR	FLIP_BOX
KEYWAIT			LDA	KEYBRD
				BPL	KEYWAIT
				JSR	CPARER2
				BEQ	OG_GORDKEY
				BIT	UNSTROB
				JMP	KEYWAIT
NOROOM			JSR	BLACK_BOX
				LDY	#$01
				JSR	TEXTER
				LDA	#$00
				STA	SPASPOT+1
ANIMATE_ORB		LDA	ORBLINE
				CMP	#$54
				BEQ	:DOWN
				DEC	ORBLINE
				JSR	DRAW
				JSR	SPACER
				BIT	UNSTROB
				LDA	#$A0
				JSR	WAIT
				JMP	ANIMATE_ORB
:DOWN			LDA	ORBLINE
				CMP	#$76
				BEQ	ANIMATE_ORB
				INC	ORBLINE
				JSR	DRAW
				JSR	SPACER
				LDA	#$A0
				JSR	WAIT
				JMP	:DOWN

SPACER			LDA	KEYBRD
				BPL	SPACOUT
				JSR	CPARER2
				BEQ	OG_GORDKEY
				BIT	UNSTROB
SPASPOT			CMP	#$A0
				BNE	SPACOUT
				PLA
				PLA
SPACOUT			RTS

OG_GORDKEY	;	LDA	#$B7
			;	STA	PROGON
				JMP	RDKEY			;*** RTS instead?

DATAORB			DFB	$43,$02,$00,$DF

DRAW			LDA	ORBLINE
				STA	LINENUM
				LDA	#$11
				STA	COUNT
				LDX	#$00
DRLOOP1			LDY	LINENUM
				LDA	LOBYTES,Y
				STA	SCREENL
				LDA	HIBYTES,Y
				ORA	PAGE
				STA	SCREENH
				CPY	#$74
				BNE	NORMAL
				JSR	DRAW2
				JMP	DRSKIP

NORMAL			LDY	#$12
DRLOOP2			LDA	ORBDATA,X
				STA	(SCREENL),Y
				INX
				INY
				CPY	#$16
				BNE	DRLOOP2
DRSKIP			INC	LINENUM
				DEC	COUNT
				BNE	DRLOOP1
				RTS

DRAW2			LDY	ORBLINE
				LDA	ODOFFS-100,Y
				STA	SCRATCH
				LDA	#$12
				STA	COUNTER
:LOOP1			LDY	SCRATCH
				LDA	ORBDATA,X
				ORA	ODATA2,Y
				LDY	COUNTER
				STA	(SCREENL),Y
				INX
				INC	SCRATCH
				INC	COUNTER
				LDA	COUNTER
				CMP	#$16
				BNE	:LOOP1
				RTS

ERASE			LDA	ORBLINE
				STA	LINENUM
				LDA	#$11
				STA	COUNT
:LOOP1			LDX	LINENUM
				LDA	LOBYTES,X
				STA	SCREENL
				LDA	HIBYTES,X
				ORA	PAGE
				STA	SCREENH
				LDY	#$12
				LDA	#$00
				CPX	#$74
				BNE	:LOOP2
				LDA	#$7F
:LOOP2			STA	(SCREENL),Y
				INY
				CPY	#$16
				BNE	:LOOP2
				INC	LINENUM
				DEC	COUNT
				BNE	:LOOP1
				RTS

BLACK_BOX		LDX	#$1D
:LOOP1			LDA	LOBYTES,X
				STA	SCREENL
				LDA	HIBYTES,X
				ORA	PAGE
				STA	SCREENH
				LDY	#$16
				LDA	#$00
:LOOP2			STA	(SCREENL),Y
				DEY
				BNE	:LOOP2
				INX
				CPX	#$38
				BNE	:LOOP1
				RTS

FLIP_BOX		LDX	#$1B
:LOOP1			LDA	LOBYTES,X
				STA	SCREENL
				STA	DESTINL
				LDA	HIBYTES,X
				ORA	#$20
				STA	SCREENH
				EOR	#$60
				STA	DESTINH
				LDY	#$17
:LOOP2			LDA	(SCREENL),Y
				PHA
				LDA	(DESTINL),Y
				STA	(SCREENL),Y
				PLA
				STA	(DESTINL),Y
				DEY
				BPL	:LOOP2
				INX
				CPX	#$3A
				BNE	:LOOP1
				RTS

ODOFFS			DFB	$00,$04,$08
				DFB	$0C,$0C,$10
				DFB	$10,$10,$10
				DFB	$10,$10,$10
				DFB	$0C,$0C,$08
				DFB	$04,$00
ORBDATA			DFB	$00,$00,$00
				DFB	$00
				DFB	$00,$50,$0A
				DFB	$00,$00,$54
				DFB	$2A,$00,$00
				DFB	$55,$2E,$01
				DFB	$00,$55,$3E
				DFB	$01,$20,$55
				DFB	$3A,$05,$20
				DFB	$55,$2A,$05
				DFB	$20,$55,$2A
				DFB	$05,$20,$55
				DFB	$2A,$05,$20
				DFB	$55,$2A,$05
				DFB	$20,$55,$2A
				DFB	$05,$20,$55
				DFB	$2A,$05,$00
				DFB	$55,$2A,$01
				DFB	$00,$55,$2A
				DFB	$01,$00,$54
				DFB	$2A,$00,$00
				DFB	$50,$0A,$00
				DFB	$00,$00,$00
				DFB	$00
ODATA2			DFB	$7F,$7F,$7F
				DFB	$7F
				DFB	$7F,$01,$00
				DFB	$7F,$3F,$00
				DFB	$00,$7C,$0F
				DFB	$00,$00,$70
				DFB	$03,$00,$00
				DFB	$40,$7F,$7F
				DFB	$7F,$7F

OG_DATA			DW	OG_TEXT
				DW	OG_LINES
				DW	OG_PICS

OG_TEXT			DW	OG_TEXT0
				DW	OG_TEXT1
				DW	OG_TEXT2

OG_TEXT0		PLOTAT	10;31;(YOU'VE_DISCOVERED_ONE_OF)
				PLOTAT	10;39;(THE_LOST_ORB_DOOR_KEYS.)
				PLOTAT	10;47;(PRESS_<SPACE>_TO_TAKE_IT.)+

OG_TEXT1		PLOTAT	10;31;(NO_ONE_IN_THE_GROUP_CAN)
				PLOTAT	10;39;(CARRY_ANYTHING_ELSE.__YOU)
				PLOTAT	10;47;(MUST_DROP_SOMETHING_FIRST.)+

OG_TEXT2		PLOTAT	0;39;(_TAKES_THE_ORB.)+

OG_LINES		DW	:LINE0

:LINE0			DFB	$00,$01,$1C
				DFB	$00,$A7,$1C
				DFB	$00,$A7,$38
				DFB	$00,$01,$38
				DFB	$00,$01,$1C
				DFB	$FF

OG_PICS			DW	:PPIC0

:PPIC0			DFB	$87,$B6,$10
				DFB	$17,$00,$00
				DFB	$01,$0F,$3F
				DFB	$7F,$7F,$3F
				DFB	$0F,$01,$FE
				DFB	$27,$00,$07
				DFB	$79,$7E,$FE
				DFB	$06,$7F,$3F
				DFB	$0F,$07,$03
				DFB	$01,$FE,$21
				DFB	$00,$03,$7F
				DFB	$7F,$3F,$5F
				DFB	$6F,$77,$7B
				DFB	$7B,$7D,$7D
				DFB	$7E,$7E,$7E
				DFB	$7F,$7F,$7F
				DFB	$3F,$3F,$5F
				DFB	$1F,$1F,$1F
				DFB	$FE,$04,$0F
				DFB	$FE,$06,$07
				DFB	$FE,$0B,$03
				DFB	$06,$01,$0F
				DFB	$01,$FE,$0E
				DFB	$7E,$FE,$05
				DFB	$3E,$FE,$08
				DFB	$5E,$FE,$10
				DFB	$6E,$5E,$00
				DFB	$FE,$0E,$7F
				DFB	$7E,$7E,$7E
				DFB	$FE,$05,$7D
				DFB	$FE,$08,$7B
				DFB	$FE,$10,$77
				DFB	$7B,$00,$7F
				DFB	$7F,$7F,$40
				DFB	$7F,$7F,$7C
				DFB	$7B,$77,$6F
				DFB	$5F,$5F,$3F
				DFB	$3F,$FE,$04
				DFB	$7F,$7E,$7E
				DFB	$7C,$7C,$7B
				DFB	$78,$78,$78
				DFB	$FE,$04,$70
				DFB	$FE,$06,$60
				DFB	$FE,$0B,$40
				DFB	$60,$00,$70
				DFB	$00,$00,$60
				DFB	$1F,$FE,$07
				DFB	$7F,$7C,$70
				DFB	$60,$40,$FE
				DFB	$24,$00,$40
				DFB	$78,$7E,$7F
				DFB	$7F,$7E,$70
				DFB	$FE,$27,$00
